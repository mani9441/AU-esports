<!doctype html>
<html lang="zxx">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Payment</title>
    <link rel="icon" href="img/favicon.png">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/all.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/slick.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="body_bg">
        <header class="main_menu single_page_menu">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-12">
                        <nav class="navbar navbar-expand-lg navbar-light">
                            <a class="navbar-brand" href="index.html"> <img src="img/logo.png" width="45" height="45" style="border-radius: 20%;"
                                    alt="logo"> </a>
                            <button class="navbar-toggler" type="button" data-toggle="collapse"
                                data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                                aria-expanded="false" aria-label="Toggle navigation">
                                <span class="menu_icon"><i class="fas fa-bars"></i></span>
                            </button>

                            <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                                <ul class="navbar-nav">
                                    <li class="nav-item">
                                        <a class="nav-link" href="index.html">Home</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="fighter.html">Games</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="team.html">team</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="blog.html">Blog</a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link" href="contact.html">Contact</a>
                                    </li>
                                </ul>
                            </div>
                            <a href="fighter.html" class="btn_1 d-none d-sm-block">Register Now</a>
                        </nav>
                    </div>
                </div>
            </div>
        </header>

        <section class="breadcrumb breadcrumb_bg">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="breadcrumb_iner text-center">
                            <div class="breadcrumb_iner_item">
                                <h2>Payment</h2>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div style="height: 100px;"></div>


        <section style="text-align: center; margin-top: 30px;">
            <div id="amountDisplay" style="font-size: 1.2em; margin-bottom: 10px; color: #ffffff;">
                Amount to be Paid: â‚¹<span id="dynamicAmount">50</span>
            </div>
            <a id="upiLink" href="upi://pay?pa=7036812082@ybl&pn=KALYANAMMANIKANTA&am=50&cu=INR"
                style="background-color: #007bff; 
                       color: white; 
                       padding: 10px 20px; 
                       text-decoration: none; 
                       border-radius: 5px; 
                       display: inline-block;">Pay Now</a>

            <div style="margin-top: 30px;">
                <label for="paymentProof" style="display: block; margin-bottom: 10px; font-size: 1.1em; color: #ffffff;">
                    Upload Payment Proof (Screenshot):
                    <br>
                    <span style="font-size: 0.9em; color: #cccccc;">
                        Please ensure the screenshot clearly displays the Transaction ID or UTR Number.
                    </span>
                </label>
                <input type="file" id="paymentProof" name="paymentProof" accept="image/*" style="margin: 0 auto;">
            </div>

            <button type="button" id="uploadScreenshot"
                style="background-color: #28a745; /* Green color for upload */
                                          color: white;
                                          padding: 10px 20px;
                                          border: none;
                                          border-radius: 5px;
                                          margin-top: 20px;
                                          cursor: pointer;">Upload Screenshot</button>

        </section>


        <footer class="footer_part">
            <div class="footer_top">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-6 col-lg-3">
                            <div class="single_footer_part">
                                <a href="index.html" class="footer_logo_iner"> <img src="img/logo.png"
                                        style="border-radius: 20%;" alt="#"> </a>
                                <p>Where passion meets play. Join the arena.</p>

                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <div class="single_footer_part">
                                <h4>Contact Info</h4>
                                <p>Address : Maddilapalem, vishakhapatanam.
                                </p>
                                <p>+91 6302332420</p>
                                <a href="mailto:auesportscontact@gmail.com"
                                    style="color: red;">auesportscontact@gmail.com </a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="copygight_text">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-8">
                            <div class="copyright_text">
                                <P>
This Website is made with <i class="ti-heart" aria-hidden="true"></i> by <a href="team.html" target="_blank">Team AUeSports</a>
</P>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="footer_icon social_icon">
                            <ul class="list-unstyled">
                                <li><a href="https://www.facebook.com/profile.php?id=61574885436990" class="single_social_icon"><i class="fab fa-facebook-f"></i></a>
                                </li>
                                <li><a href="https://x.com/AUEsports349473?t=ptDBXTnjcMKpKFt10n50kQ&s=09" class="single_social_icon"><i class="fab fa-twitter"></i></a></li>
                                <li><a href="https://www.instagram.com/auesports__?igsh=MTducndxa2Q0cTQ0Nw==" class="single_social_icon"><i class="fab fa-instagram"></i></a></li>
                                <li><a href="https://www.linkedin.com/in/au-esports-88577435a/" class="single_social_icon"><i class="fab fa-linkedin"></i></a></li>
                            </ul>
                        </div>
</div>
                    </div>
                </div>
            </div>
        </footer>
        </div>

    <script src="js/jquery-1.12.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.magnific-popup.js"></script>
    <script src="js/swiper.min.js"></script>
    <script src="js/masonry.pkgd.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/slick.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/waypoints.min.js"></script>
    <script src="js/contact.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="js/custom.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const regId = urlParams.get('reg_id');
        const gameType = urlParams.get('game_type');
        const amount = urlParams.get('amount');
        const parameter = urlParams.get('parameter');
        
        // Prevent multiple auto-submissions on refresh
        if (!sessionStorage.getItem("registered_" + regId)) {
            if (parameter === "SINGLE") {
                const email = urlParams.get("email");
                const username = urlParams.get("username");
                const uid = urlParams.get("uid");
    
                fetch('/register_', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, username, uid, parameter, regId, gameType })
                }).then(() => {
                    sessionStorage.setItem("registered_" + regId, "true");
                });
            } else if (parameter === "TEAM") {
                const membersSerialized = urlParams.get("members");

                // Deserialize the members data (it's URL-encoded, so decode it first)
                const members = JSON.parse(decodeURIComponent(membersSerialized));
    
                fetch("/register_", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        teamName: "Unnamed Team",
                        members: members,
                        parameter: parameter,
                        regId: regId,
                        gameType: gameType
                    })
                }).then(() => {
                    sessionStorage.setItem("registered_" + regId, "true");
                });
            }
        }
    
        document.getElementById("dynamicAmount").textContent = amount;
        document.getElementById("upiLink").href = `upi://pay?pa=7036812082@ybl&pn=KALYANAMMANIKANTA&am=${amount}&cu=INR`;
    
        let isUploading = false; // flag to prevent multiple uploads
    
        document.getElementById("uploadScreenshot").addEventListener("click", function (e) {
            e.preventDefault();
    
            if (isUploading) return;
    
            const fileInput = document.getElementById("paymentProof");
            const file = fileInput.files[0];
    
            if (!file) {
                alert("Please select a screenshot to upload.");
                return;
            }
    
            isUploading = true;
            const button = document.getElementById("uploadScreenshot");
            button.disabled = true;
            button.innerText = "Uploading...";
    
            const formData = new FormData();
            formData.append("screenshot", file);
            formData.append("reg_id", regId);
            formData.append("game_type", gameType);
    
            fetch("/upload-payment", {
                method: "POST",
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                alert("Screenshot uploaded successfully! Awaiting admin confirmation.");
                document.body.innerHTML += `<p>Your Registration ID: ${regId}</p>`;
                setTimeout(() => {
                    window.location.href = "/index.html";
                }, 5000);
            })
            .catch(err => {
                console.error(err);
                alert("Error uploading screenshot.");
                isUploading = false;
                button.disabled = false;
                button.innerText = "Upload Screenshot";
            });
        });
    </script>
    
</body>

</html>
